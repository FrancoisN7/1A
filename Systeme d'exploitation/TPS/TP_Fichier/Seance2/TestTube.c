#include <stdio.h>
#include <unistd.h>
#include <stdlib.h> /* exit */
#include <fcntl.h>

int main(){
    int fils = 1;
    int pipe_f2p[2];
    int retour = pipe(pipe_f2p);
    
/* Bonne pratique : tester systématiquement le retour des appels système */
    if (retour == -1) {   /* échec du pipe */
        printf("Erreur pipe\n");
/* Convention : s'arrêter avec une valeur > 0 en cas d'erreur */
        exit(1);
    }


    retour = fork();
    /* Bonne pratique : tester systématiquement le retour des appels système */
    if (retour < 0) {   /* échec du fork */
        printf("Erreur fork\n") ;
    /* Convention : s'arrêter avec une valeur > 0 en cas d'erreur */
        exit(1) ;
    }

    /* fils */
    if (retour == 0) {
        /* fermer l'extrémité 0 : le fils va écrire dans le pipe */
        // close(pipe_f2p[0]) ;
        int pid = getpid() ;
        printf("\nProcessus de pid %d, de pere %d\n", pid, getppid()) ;
        /* écrire 2 fois son pid dans le pipe */
        write(pipe_f2p[1], &pid, sizeof(int)) ;
        write(pipe_f2p[1], &pid, sizeof(int)) ;
        /* fermer l'extrémité 1 : fin des envois */
        /* la prochaine lecture sur ce pipe renverra 0 */
        close(pipe_f2p[1]) ;
        /* Important : terminer un processus par exit */
        exit(EXIT_SUCCESS) ;   /* Terminaison normale (0 = sans erreur) */
    }

    /* pere */
    else {
        printf("\nProcessus de pid %d a cree un fils numero %d, de pid %d \n", 
    getpid(), fils, retour) ;
    }
    
}