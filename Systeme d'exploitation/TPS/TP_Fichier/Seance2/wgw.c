#include <stdio.h>
#include <unistd.h>
#include <stdlib.h> /* exit */
#include <fcntl.h>
#define NB_FILS 3


int main(){
    int fils;
    int pipe_f2p[2];
    int retour = pipe(pipe_f2p);
    
    /* Bonne pratique : tester systématiquement le retour des appels système */
    if (retour == -1) {   /* échec du pipe */
        printf("Erreur pipe\n");
        /* Convention : s'arrêter avec une valeur > 0 en cas d'erreur */
        exit(1);
    }

    for (fils = 1 ; fils <= NB_FILS ; fils++) {
        retour = fork();
        /* Bonne pratique : tester systématiquement le retour des appels système */
        if (retour < 0) {   /* échec du fork */
            printf("Erreur fork\n") ;
            /* Convention : s'arrêter avec une valeur > 0 en cas d'erreur */
            exit(1) ;
        }

        /* fils */
        if (retour == 0) {
            /* fermer l'extrémité 0 : le fils va écrire dans le pipe */
            close(pipe_f2p[0]);



            //if ret = 1 | 2 | 3 ...



            /* fermer l'extrémité 1 : fin des envois */
            /* la prochaine lecture sur ce pipe renverra 0 */
            close(pipe_f2p[1]);
            /* Important : terminer un processus par exit */
            exit(EXIT_SUCCESS);   /* Terminaison normale (0 = sans erreur) */
        }

        /* pere */
        else {
            printf("\nProcessus de pid %d a cree un fils numero %d, de pid %d \n", 
        getpid(), fils, retour) ;
        }
    }
}