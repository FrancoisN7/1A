#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <fcntl.h>
#include <string.h>

int main () {
    pid_t pidFils ;
    pid_t pidFrere ;
    int indice;
    int BUFSIZE = 30;
    char texte[BUFSIZE];
    int lus;
    char buf[BUFSIZE];
    int desc;
    
    desc = open("temp.txt", O_RDWR | O_CREAT | O_TRUNC, 0700); 
    pidFils = fork ();
    pidFrere = fork (); 

    //erreur du fork
    if (pidFils == -1) {
        printf ("Erreur fork \n");
        exit (1);
    }
    
    //Fils
    if (pidFils == 0) {
        indice = 1;
        while (indice != BUFSIZE + 1){
            sprintf(texte, "%d", indice);
            if (indice % 10 == 1){
                lseek(desc, 0, SEEK_SET);
            }
            write(desc, texte, strlen(texte));
            write(desc, "\n", strlen("\n"));
            indice++;
            sleep(1);
        }
        exit(2);
    }
       
    //erreur du fork
   if (pidFrere == -1) {
        printf ("Erreur fork \n");
        exit (1);
    }
    
    //Frere
    if (pidFrere == 0) {
        sleep(2); 
        do {
        lus = read(desc, buf, BUFSIZE-1);
        printf("%d", lus);
        } while (lus > 0);
        exit(2);
    }
        
    //PÃ¨re 
    else {
        sleep(35);
    }

}
