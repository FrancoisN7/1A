#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>
#include <sys/wait.h> /* wait */
#include <stdbool.h>

int main() {
    char buf [30] ; /* contient la commande saisie au clavier */
    int ret; /* valeur de retour de scanf */
    pid_t pidFils , idFils;
    int codeTerm;
    bool sortie;
    
    do {
        printf(">>> ");
        ret = scanf("%s", buf);
        
        sortie = (ret != 1 || strcmp("exit",buf) == 0);

        if (!sortie) {
        
        pidFils = fork();
        /* bonne pratique : tester systématiquement le retour des appels système */
        if (pidFils == -1) {
        NULL;
        }
        if (pidFils == 0) { /* fils */   
        execlp(buf, buf, NULL);
        
        printf ("ECHEC \n");
        exit(2);
        }
    
        else { /* père */
        idFils = wait(&codeTerm);
        if ( idFils == -1) {
        perror ("wait");
            exit (8);
        }
        }
        
        if (WEXITSTATUS(codeTerm) != 2) {
        printf ("SUCCES \n");
        }
        }
    } while (!sortie);
    
    
    //Affichage Salut à la sortie de la boucle
    if (ret !=  1){
        printf("\n");
    }
    printf("Salut \n");
    
    return EXIT_SUCCESS; /* -> exit(EXIT_SUCCESS); pour le père */
}
